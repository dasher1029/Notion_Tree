<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Tree View</title>
  <style>
    body { font-family: system-ui; }
    .tree-container {
      display: flex;
      justify-content: center;
      width: 100%;
      height: 800px;
      overflow: auto;
      border: 1px solid #ddd;
    }
    svg { 
      display: block; 
    }
    .link {
      fill: none;
      stroke: #aaa;
    }
    .node {
      fill: #4f46e5;
    }
    .label {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">ğŸ“Š Notion íŠ¸ë¦¬ ì‹œê°í™”</h1>

  <div class="tree-container">
    <svg id="tree"></svg>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    async function loadTree() {
      const res = await fetch("/api/tree-data", { credentials: "include" });
      const data = await res.json();

      const root = d3.hierarchy(data);

      // ğŸŒŸ íŠ¸ë¦¬ ë ˆì´ì•„ì›ƒ ê°„ê²© ì„¤ì •
      const treeLayout = d3.tree()
        .nodeSize([120, 260]); // [ê°€ë¡œ ê°„ê²©, ì„¸ë¡œ ê°„ê²©]

      // ë ˆì´ì•„ì›ƒì„ ë¨¼ì € ê³„ì‚°ì‹œí‚µë‹ˆë‹¤.
      treeLayout(root);

      // ğŸŒŸ 1. (ê²¹ì¹¨ ë°©ì§€) í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•˜ì—¬ ì‹¤ì œ íŠ¸ë¦¬ì˜ ë°”ìš´ë”ë¦¬(ê²½ê³„)ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
      let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
      root.descendants().forEach(d => {
        if (d.x < minX) minX = d.x;
        if (d.x > maxX) maxX = d.x;
        if (d.y < minY) minY = d.y;
        if (d.y > maxY) maxY = d.y;
      });

      // í…ìŠ¤íŠ¸ ë¼ë²¨ ë“±ì„ ìœ„í•œ ì—¬ë°±(padding)
      const padding = { top: 50, right: 150, bottom: 80, left: 150 };

      // ğŸŒŸ 2. (ìŠ¤í¬ë¡¤ë°”) SVGì˜ ì „ì²´ í¬ê¸°ë¥¼ íŠ¸ë¦¬ì˜ ì‹¤ì œ í¬ê¸°ì— ë§ê²Œ ë™ì ìœ¼ë¡œ ì„¤ì •
      const svgWidth = (maxX - minX) + padding.left + padding.right;
      const svgHeight = (maxY - minY) + padding.top + padding.bottom;

      const svg = d3.select("#tree")
        .attr("width", svgWidth)   // ğŸ‘ˆ ê³„ì‚°ëœ ì „ì²´ ë„ˆë¹„
        .attr("height", svgHeight); // ğŸ‘ˆ ê³„ì‚°ëœ ì „ì²´ ë†’ì´
                                     // (ì´ í¬ê¸°ê°€ .tree-containerë³´ë‹¤ í¬ë©´ ìŠ¤í¬ë¡¤ë°”ê°€ ìƒê¹€)

      // ğŸŒŸ 3. <g> íƒœê·¸ë¥¼ ì´ë™ì‹œì¼œ íŠ¸ë¦¬ê°€ SVG ì¤‘ì•™ì— ì˜¤ë„ë¡ í•¨
      const g = svg.append("g")
        .attr("transform", `translate(${-minX + padding.left}, ${-minY + padding.top})`);


      // Links (ì„  ê·¸ë¦¬ê¸°)
      // d3.linkVertical()ì„ ì‚¬ìš©í•´ ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ìœ¼ë¡œ ë³€ê²½
      g.selectAll(".link")
        .data(root.links())
        .enter()
        .append("path") // ğŸ‘ˆ "line" ëŒ€ì‹  "path" ì‚¬ìš©
        .attr("class", "link")
        .attr("d", d3.linkVertical() // ğŸ‘ˆ ìˆ˜ì§ ë§í¬ ìƒì„±ê¸°
          .x(d => d.x)
          .y(d => d.y));

      // Nodes (ì› ê·¸ë¦¬ê¸°)
      const node = g.selectAll(".node")
        .data(root.descendants())
        .enter()
        .append("g") // ğŸ‘ˆ <g> íƒœê·¸ë¡œ ì›ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê·¸ë£¹í™”
        .attr("class", "node")
        .attr("transform", d => `translate(${d.x},${d.y})`); // ğŸ‘ˆ cx, cy ëŒ€ì‹  transform ì‚¬ìš©

      node.append("circle")
        .attr("r", 6)
        .attr("fill", "#4f46e5");

      // Labels (í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°)
      // ğŸŒŸ 4. (ê²¹ì¹¨ ë°©ì§€) í…ìŠ¤íŠ¸ë¥¼ ë…¸ë“œ 'ì•„ë˜'ì— ì¤‘ì•™ ì •ë ¬í•˜ì—¬ ê²¹ì¹¨ì„ ë°©ì§€
      node.append("text")
        .attr("class", "label")
        .attr("y", 20) // ğŸ‘ˆ ì› ì•„ë˜ìª½ 20px ì§€ì 
        .attr("text-anchor", "middle") // ğŸ‘ˆ í…ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ ì •ë ¬
        .text(d => d.data.title);
    }

    loadTree();
  </script>
</body>
</html>